---
title: 输入url之后发生了什么
date: 2021/3/18 00:15
tags: 浏览器
categories: 浏览器
---

# 在浏览器地址栏输入 URL

- 浏览器查看缓存，请求资源在缓存中并且未过期，跳转到转码步骤 如果浏览器未缓存，发起新的请求已缓存，检验是否过期，未过期直接提供给客户端，否则进行验证检验是否过期 通常有两个 http 头进行控制，expires 和 cache-control。
- 浏览器解析 URL 获取协议，主机，端口，path
- 浏览器组装一个 http 请求 请求报文
- 浏览器获取主机 ip 地址：(dns 解析过程)过程：浏览器缓存 -> 本地缓存-> hosts 文件 -> 路由器缓存 -> ISP DNS 缓存 -> DNS 递归查询（根服务器 -> .com 顶级域名服务器 -> 供应商服务器）
- 打开一个 socket 与目标地址建立 TCP 连接，进行三次握手
  - 客户端发送一个 TCP 的 SYN=1，Sep=X 的包到服务器端口
  - 服务器返回 SYN=1，ACK=X+1，Sep=Y 的响应包
  - 客户端发送 ACK=Y+1，Sep=Z
    > TCP 连接建立发送 http 请求。
- 服务器接收请求并解析，将请求转发到服务程序
- 服务器检查 http 请求头是否包含缓存验证信息，如果验证有缓存，返回 304 等对应状态码
  处理程序读取完整请求并准备 http 响应，可能需要查询数据库等操作
- 服务器将响应报文通过 TCP 连接发送回浏览器
- 浏览器接收到 http 响应，然后根据情况选择关闭 TCP 连接或者保留重用。（关闭操作进行第四次挥手）
  - 主动方发送 Fin=1，Ack=Z，Sep=X 的报文
  - 被动方发送 ACK=X+1，Sep=Z 报文
  - 被动方发送 Fin=1，ACK=X，Sep=Y 报文
  - 主动方发送 ACK=Y，Sep=X 报文
    浏览器检查响应状态码。状态吗不同 解决的方法不同 1XX 3XX 4XX 5XX 区别对待 2XX 是正常返回
    如果资源可缓存，进行缓存
    对响应解码 例如 gzip 压缩

> 解析 html 文档 构建 dom 树 下载资源，构建 css 树，执行 js 脚本

- 构建 dom 树
  - 解析过程遇到图片、样式表、js 文件、启动下载
- 构建 css 树
- 根据 dom 树和 css 树整合构建渲染树
- js 解析
- 渲染页面
